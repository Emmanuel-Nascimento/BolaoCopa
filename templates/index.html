{% extends "base.html" %}

{% block content %}
<div class="text-center mt-4 mb-5">
    <h1>âš½ Jogos da Rodada</h1>
    <p class="text-muted">FaÃ§a seus palpites antes que o tempo acabe!</p>
</div>

<div class="row">
    {% for jogo in jogos %}
    <div class="col-md-4 mb-4">
        <div class="card shadow-sm h-100 text-center border-0">
            <div class="card-header bg-light">
                ðŸ“… {{ jogo.data_hora.strftime('%d/%m Ã s %H:%M') }}
            </div>
            
            <div class="card-body">
                <h5 class="card-title d-flex justify-content-center align-items-center gap-2">
                    {% if bandeiras.get(jogo.time_a) %}
                        <img src="https://flagcdn.com/w40/{{ bandeiras[jogo.time_a] }}.png" alt="{{ jogo.time_a }}" class="flag-img" loading="lazy">
                    {% endif %}
                    
                    {{ jogo.time_a }} <span class="text-danger mx-2">X</span> {{ jogo.time_b }}

                    {% if bandeiras.get(jogo.time_b) %}
                        <img src="https://flagcdn.com/w40/{{ bandeiras[jogo.time_b] }}.png" alt="{{ jogo.time_b }}" class="flag-img" loading="lazy">
                    {% endif %}
                </h5>

                {% if jogo.resultado_real %}
                    <div class="mt-3">
                        <span class="badge bg-secondary mb-2">JOGO ENCERRADO</span>
                        <div class="alert alert-dark p-2">
                            Resultado: 
                            <strong>
                                {% if jogo.resultado_real == 'time_a' %} {{ jogo.time_a }} Venceu
                                {% elif jogo.resultado_real == 'time_b' %} {{ jogo.time_b }} Venceu
                                {% else %} Empate {% endif %}
                            </strong>
                        </div>
                        
                        {% if meus_palpites.get(jogo.id) %}
                           <small class="text-muted">Seu palpite foi: 
                               {% if meus_palpites.get(jogo.id) == 'time_a' %} {{ jogo.time_a }}
                               {% elif meus_palpites.get(jogo.id) == 'time_b' %} {{ jogo.time_b }}
                               {% else %} Empate {% endif %}
                           </small>
                        {% else %}
                           <small class="text-muted">VocÃª nÃ£o palpitou neste jogo.</small>
                        {% endif %}
                    </div>

                {% elif agora > jogo.data_hora %}
                    <div class="mt-3">
                        <span class="badge bg-danger mb-2">APOSTAS ENCERRADAS</span>
                        <p class="text-muted small">Aguardando resultado oficial...</p>
                        
                        <div class="btn-group w-100" role="group">
                             <button class="btn disabled {{ 'btn-success' if meus_palpites.get(jogo.id) == 'time_a' else 'btn-outline-secondary' }}">{{ jogo.time_a }}</button>
                             <button class="btn disabled {{ 'btn-secondary' if meus_palpites.get(jogo.id) == 'empate' else 'btn-outline-secondary' }}">Empate</button>
                             <button class="btn disabled {{ 'btn-primary' if meus_palpites.get(jogo.id) == 'time_b' else 'btn-outline-secondary' }}">{{ jogo.time_b }}</button>
                        </div>
                    </div>

                {% else %}
                    <p class="card-text text-muted small">Quem vence?</p>

                    {% if current_user.is_authenticated %}
                        <div class="btn-group w-100" role="group">
                            <a href="{{ url_for('palpitar', jogo_id=jogo.id, escolha='time_a') }}" 
                               class="btn {{ 'btn-success' if meus_palpites.get(jogo.id) == 'time_a' else 'btn-outline-success' }}">
                               {{ jogo.time_a }}
                            </a>

                            <a href="{{ url_for('palpitar', jogo_id=jogo.id, escolha='empate') }}" 
                               class="btn {{ 'btn-secondary' if meus_palpites.get(jogo.id) == 'empate' else 'btn-outline-secondary' }}">
                               Empate
                            </a>

                            <a href="{{ url_for('palpitar', jogo_id=jogo.id, escolha='time_b') }}" 
                               class="btn {{ 'btn-primary' if meus_palpites.get(jogo.id) == 'time_b' else 'btn-outline-primary' }}">
                               {{ jogo.time_b }}
                            </a>
                        </div>
                    {% else %}
                        <div class="alert alert-light border">
                            <a href="{{ url_for('login') }}">FaÃ§a login</a> para apostar!
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    {% else %}
        <div class="alert alert-warning text-center">
            Nenhum jogo cadastrado ainda.
        </div>
    {% endfor %}
</div>
{% endblock %}